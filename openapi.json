{"openapi":"3.1.0","info":{"title":"FaceOn Entry System API","description":"\n    ## Purpose\n    API for an advanced access control system utilizing two-factor authentication:\n    * **Possession**: QR Code generated per employee.\n    * **Inherence**: Biometric facial recognition using DeepFace.\n\n    ## Access\n    Most endpoints under `/admin` require a valid JWT Bearer Token.\n    ","version":"1.0.0"},"paths":{"/admin/health":{"get":{"tags":["admin"],"summary":"Health Check","operationId":"health_check_admin_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/admin/qr_test/{uuid_value}":{"get":{"tags":["admin"],"summary":"Qr Test","description":"Generates a QR code for the given UUID value.\nOn address /admin/qr_test/{uuid_value} you will get a QR code image.","operationId":"qr_test_admin_qr_test__uuid_value__get","parameters":[{"name":"uuid_value","in":"path","required":true,"schema":{"type":"string","title":"Uuid Value"}},{"name":"email","in":"query","required":false,"schema":{"type":"string","title":"Email"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/login":{"post":{"tags":["admin"],"summary":"Login For Access Token","description":"Administrator Login:\n1. Checks if the user exists in the database.\n2. Verifies the password (hash).\n3. Returns a JWT token.","operationId":"login_for_access_token_admin_login_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_for_access_token_admin_login_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/create_employee":{"post":{"tags":["admin"],"summary":"Create Employee","description":"Registers a new employee and triggers credentials delivery.\n\nWorkflow:\n1. Processes the photo to generate a 512-D biometric embedding.\n2. Sets an account expiration date (defaults to 182 days if not provided).\n3. Generates a unique QR code and sends it via email as a background task.\n\nArgs:\n    photo (UploadFile): Initial biometric reference photo.\n    name (str): Full name of the employee.\n    email (str): Contact email for QR code delivery.\n    expiration_date (datetime, optional): Specific timestamp for account expiration.\n    db (Session): Database session.\n    current_admin (Admin): Authenticated administrator.\n\nReturns:\n    EmployeeResponse: The newly created employee record.","operationId":"create_employee_admin_create_employee_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_create_employee_admin_create_employee_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmployeeResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/admin/employees":{"get":{"tags":["admin"],"summary":"Get All Employees","description":"Retrieves a list of all registered employees.\n\nArgs:\n    db (Session): Database session.\n    current_admin (Admin): Authenticated administrator performing the request.\n\nReturns:\n    List[schemas.Employee]: A list of employee objects including their IDs,\n                            names, emails, and account status.","operationId":"get_all_employees_admin_employees_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/EmployeeResponse"},"type":"array","title":"Response Get All Employees Admin Employees Get"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/admin/employees/{employee_uid}/status":{"patch":{"tags":["admin"],"summary":"Update Employee Status","description":"Updates the access status and specific expiration timestamp for an employee.\n\nThis endpoint is intended for quick administrative actions, such as\ninstantly revoking access or setting a specific date/time when the\nemployee's QR/access should expire.\n\nArgs:\n    employee_uid (str): The unique UUID of the employee.\n    is_active (bool, optional): The new active status. If not provided,\n        the current status remains unchanged.\n    expiration_date (datetime, optional): A specific timestamp (ISO 8601)\n        representing when the employee's access expires.\n    db (Session): Database session dependency.\n    current_admin (Admin): The authenticated administrator performing the action.\n\nReturns:\n    dict: A success message along with the updated status and expiration date.\n\nRaises:\n    HTTPException:\n        - 400: If the UUID format is invalid.\n        - 404: If no employee is found with the provided UUID.","operationId":"update_employee_status_admin_employees__employee_uid__status_patch","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"employee_uid","in":"path","required":true,"schema":{"type":"string","title":"Employee Uid"}}],"requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"allOf":[{"$ref":"#/components/schemas/Body_update_employee_status_admin_employees__employee_uid__status_patch"}],"title":"Body"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/employees/{employee_uid}":{"put":{"tags":["admin"],"summary":"Update Employee","description":"Updates an existing employee's full profile information.\n\nThis endpoint allows for a comprehensive update, including personal details,\nbiometrics (via photo upload), and administrative access controls. If a new\nphoto is uploaded, the system re-calculates the facial embedding vector.\n\nArgs:\n    employee_uid (str): Unique identifier of the employee to be updated.\n    name (str, optional): New full name of the employee.\n    email (str, optional): New email address (must be unique across the system).\n    photo (UploadFile, optional): New reference image for facial recognition.\n    is_active (bool, optional): Administrative override to enable/disable access.\n    expiration_date (datetime, optional): Specific timestamp for access expiration.\n    db (Session): Database session dependency.\n    current_admin (Admin): The authenticated administrator performing the update.\n\nReturns:\n    dict: Confirmation message and the updated employee UUID.\n\nRaises:\n    HTTPException:\n        - 400: Invalid UUID, email already taken, or no face detected in photo.\n        - 404: Employee not found.","operationId":"update_employee_admin_employees__employee_uid__put","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"employee_uid","in":"path","required":true,"schema":{"type":"string","title":"Employee Uid"}}],"requestBody":{"content":{"multipart/form-data":{"schema":{"allOf":[{"$ref":"#/components/schemas/Body_update_employee_admin_employees__employee_uid__put"}],"title":"Body"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["admin"],"summary":"Delete Employee","description":"Permanently removes an employee and their associated data from the system.\n\nThis action will also remove the employee's biometric embeddings and access logs.\nRevokes access immediately as the QR code associated with this ID will no longer be valid.\n\nArgs:\n    employee_id (int): The numeric ID of the employee to be deleted.\n    db (Session): Database session.\n    current_admin (Admin): Authenticated administrator performing the action.\n\nReturns:\n    dict: Success message upon deletion.","operationId":"delete_employee_admin_employees__employee_uid__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"employee_uid","in":"path","required":true,"schema":{"type":"string","title":"Employee Uid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/admin/logs":{"get":{"tags":["admin"],"summary":"Get Access Logs","description":"Retrieves all access logs recorded in the system.\n\nEach log entry includes details such as timestamp, employee name,\naccess status, reason for denial (if applicable), and debug distance\nfor biometric checks.\n\nArgs:\n    db (Session): Database session.\n    current_admin (Admin): Authenticated administrator performing the request.\n\nReturns:\n    List[schemas.LogEntry]: A list of access log entries.","operationId":"get_access_logs_admin_logs_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/LogEntry"},"type":"array","title":"Response Get Access Logs Admin Logs Get"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/admin/logs/export":{"get":{"tags":["admin"],"summary":"Export Logs Csv","description":"Generates and returns a CSV file containing all access logs.","operationId":"export_logs_csv_admin_logs_export_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/terminal/access-verify":{"post":{"tags":["terminal"],"summary":"Verify Access","description":"Verifies employee identity using a 2FA flow (QR Code + Face Recognition).\n\nThis endpoint validates the scanned QR UUID, checks the employee's status/expiry,\nand performs a biometric comparison between the live photo and the stored template.\n\nArgs:\n    employee_uid (str): The unique identifier decoded from the employee's QR code.\n    file (UploadFile): Real-time image capture from the terminal camera.\n    db (Session): Database session provided by the dependency injection.\n\nReturns:\n    Dict[str, Any]: A dictionary containing:\n        - access (str): \"GRANTED\" if both factors pass, \"DENIED\" otherwise.\n        - reason (str, optional): The cause of denial (e.g., \"FACE_MISMATCH\").\n        - name (str, optional): Employee's full name if access is granted.\n\nNote:\n    The biometric threshold is currently set to 0.3 for the Facenet512 model.","operationId":"verify_access_api_terminal_access_verify_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_verify_access_api_terminal_access_verify_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Verify Access Api Terminal Access Verify Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"Body_create_employee_admin_create_employee_post":{"properties":{"photo":{"type":"string","format":"binary","title":"Photo"},"name":{"type":"string","title":"Name"},"email":{"type":"string","title":"Email"},"expiration_date":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expiration Date"}},"type":"object","required":["photo","name","email"],"title":"Body_create_employee_admin_create_employee_post"},"Body_login_for_access_token_admin_login_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"password"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_for_access_token_admin_login_post"},"Body_update_employee_admin_employees__employee_uid__put":{"properties":{"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"photo":{"type":"string","format":"binary","title":"Photo"},"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active"},"expiration_date":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expiration Date"}},"type":"object","title":"Body_update_employee_admin_employees__employee_uid__put"},"Body_update_employee_status_admin_employees__employee_uid__status_patch":{"properties":{"is_active":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Active"},"expiration_date":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expiration Date"}},"type":"object","title":"Body_update_employee_status_admin_employees__employee_uid__status_patch"},"Body_verify_access_api_terminal_access_verify_post":{"properties":{"employee_uid":{"type":"string","title":"Employee Uid"},"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["employee_uid","file"],"title":"Body_verify_access_api_terminal_access_verify_post"},"EmployeeResponse":{"properties":{"uuid":{"type":"string","format":"uuid","title":"Uuid"},"name":{"type":"string","title":"Name"},"email":{"type":"string","title":"Email"},"is_active":{"type":"boolean","title":"Is Active"},"expires_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Expires At"}},"type":"object","required":["uuid","name","email","is_active","expires_at"],"title":"EmployeeResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"LogEntry":{"properties":{"id":{"type":"integer","title":"Id"},"timestamp":{"type":"string","title":"Timestamp"},"employee_name":{"type":"string","title":"Employee Name"},"status":{"type":"string","title":"Status"},"reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason"},"employee_email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Employee Email"},"debug_distance":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Debug Distance"}},"type":"object","required":["id","timestamp","employee_name","status"],"title":"LogEntry"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"admin/login"}}}}}}
